#!/usr/bin/env ruby
require 'ffi-ncurses'
require File.expand_path('../../lib/rfd', __FILE__)

FFI::NCurses.initscr
FFI::NCurses.raw
FFI::NCurses.noecho
FFI::NCurses.start_color

begin
  rfd = Rfd::BaseWindow.new ARGV[0] || '.'

  loop do
    c = FFI::NCurses.getch
    case c
    when 10  # enter
      rfd.enter
    when 27  # esc
      rfd.q
    when 127  # BS
      rfd.bs
    when (?a.ord)..(?z.ord), (?A.ord)..(?Z.ord)
      rfd.main.public_send c.chr if rfd.command_mode? && rfd.main.respond_to?(c.chr)
    else
      p c
    end
  end
ensure
  FFI::NCurses.endwin
end
